<!doctype html><html lang=en-us prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=manifest href=manifest.webmanifest><link rel=icon type=image/png href=/img/favicon/favicon_hu_77ed901cba198b50.png><link rel=apple-touch-icon type=image/png href=/img/favicon/favicon_hu_7dfc5c06c37dc39c.png><meta name=description content="This blog post introduces iCDump, an new Objective-C class dump based on LLVM"><meta name=keywords content="iOS,Objective-C,LLVM,OSX"><meta property="og:type" content="article"><meta property="og:description" content="This blog post introduces iCDump, an new Objective-C class dump based on LLVM"><meta property="og:title" content="iCDump: A Modern Objective-C Class Dump | Romain Thomas"><meta property="og:site_name" content="Romain Thomas"><meta property="og:image" content="https://www.romainthomas.fr/post/23-01-icdump/featured.webp"><meta property="og:url" content="https://www.romainthomas.fr/post/23-01-icdump/"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2023-01-04T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-04T10:30:10+01:00"><meta property="article:tag" content="iOS"><meta property="article:tag" content="Objective-C"><meta property="article:tag" content="LLVM"><meta property="article:tag" content="OSX"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@rh0main"><meta name=twitter:creator content="@rh0main"><meta name=twitter:title content="iCDump: A Modern Objective-C Class Dump | Romain Thomas"><meta name=twitter:description content="This blog post introduces iCDump, an new Objective-C class dump based on LLVM"><meta name=twitter:domain content="https://www.romainthomas.fr/post/23-01-icdump/"><meta property="twitter:image" content="https://www.romainthomas.fr/post/23-01-icdump/featured.webp"><title>Romain Thomas</title>
<link rel=canonical href=https://www.romainthomas.fr/post/23-01-icdump/><link rel=stylesheet href=/css/fa-all.min.css><link rel=stylesheet href=/vendor/@glidejs/glide/dist/css/glide.core.min.css><link rel=stylesheet href=/vendor/@glidejs/glide/dist/css/glide.theme.min.css><link rel=stylesheet href=/css/theme.bundle.css><style>.hide{opacity:0}</style><noscript><style>.hide{opacity:1;!important}</style></noscript><style>.hero_background{position:relative;overflow:hidden}.hero_background:before{pointer-events:none;content:' ';display:block;position:absolute;left:0;top:0;width:100%;height:90%;z-index:1;opacity:.2;background-image:url(/img/bg_home.svg);background-repeat:repeat;background-position:50%;background-size:100%;transform:rotate(180deg)}.project_bg{position:relative;overflow:hidden}.project_bg:before{pointer-events:none;content:' ';display:block;position:absolute;left:0;top:0;width:100%;height:100%;z-index:1;opacity:.1;background-image:url(/img/bg_project.svg);background-repeat:repeat;background-position:50%;background-size:100%;transform:rotate(180deg)}.experience_bg{position:relative;overflow:hidden}.experience_bg:before{pointer-events:none;content:' ';display:block;position:absolute;left:0;top:0;width:100%;height:100%;z-index:1;opacity:.1;background-image:url(/img/bg_experience.svg);background-position:0 0;background-size:100%}.post_bg{position:relative;overflow:hidden}.post_bg:before{pointer-events:none;content:' ';display:block;position:absolute;left:0;top:0;width:100%;height:80%;z-index:1;opacity:.6;background-image:url(/img/bg_post.svg);background-position:0 0;background-size:100%}.contact_bg{position:relative;overflow:hidden}.contact_bg:before{pointer-events:none;content:' ';display:block;position:absolute;left:0;top:0;width:100%;height:80%;z-index:1;opacity:.2;background-image:url(/img/bg_contact.svg);background-position:0 0;background-size:100%}.footnotes p{margin-bottom:0}.highlight{padding-left:20px;border-left:1px solid rgba(0,0,0,.1);border-radius:2px 2px}</style></head><body><header class=header-global><nav id=navbar-main aria-label="Primary navigation" class="navbar navbar-main navbar-expand-lg navbar-theme-primary headroom navbar-dark"><div class="container position-relative"><a class="navbar-brand me-lg-5" href=https://www.romainthomas.fr/><span class="navbar-brand-dark ft-ananda">R. T</span>
<span class="navbar-brand-light ft-ananda">R. T</span></a><div class="navbar-collapse collapse me-auto" id=navbar_global><div class=navbar-collapse-header><div class=row><div class="col-6 collapse-close"><a href=#navbar_global class="fas fa-times" data-bs-toggle=collapse data-bs-target=#navbar_global aria-controls=navbar_global aria-expanded=false title=close aria-label="Toggle navigation"></a></div></div></div><ul class="navbar-nav navbar-nav-hover align-items-lg-center"><li class=nav-item><a href=https://www.romainthomas.fr/#about class="nav-link fw-bold"><span class="fa-regular fa-person-swimming"></span> About</a></li><li class=nav-item><a href=https://www.romainthomas.fr/#posts class="nav-link fw-bold"><span class="fa-regular fa-blog"></span> Posts</a></li><li class=nav-item><a href=https://www.romainthomas.fr/#projects class="nav-link fw-bold"><span class="fa-regular fa-terminal"></span> Projects</a></li><li class=nav-item><a href=https://www.romainthomas.fr/#publications class="nav-link fw-bold"><span class="far fa-book-open-cover"></span> Publications</a></li><li class=nav-item><a href=https://www.romainthomas.fr/#trainings class="nav-link fw-bold"><span class="far fa-books"></span> Trainings</a></li><li class=nav-item><a href=https://www.romainthomas.fr/#misc class="nav-link fw-bold"><span class="fa-regular fa-chart-network"></span> Misc</a></li><li class=nav-item><a href=https://www.romainthomas.fr/#contact class="nav-link fw-bold"><span class="fa-regular fa-binary-lock"></span> Contact</a></li></ul></div><div class="d-flex align-items-center"><button class="navbar-toggler ms-2 collapsed" type=button data-bs-toggle=collapse data-bs-target=#navbar_global aria-controls=navbar_global aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button></div></div></nav></header><main><section class="section-header pb-5 pb-sm-7 bg-primary text-white post_bg"><div class=container><div class="row justify-content-center"><div class="col-12 col-lg-10 text-center"><div class=mb-4><a href=/categories/ios/><span class="me-2 badge alert-info text-uppercase px-3 btn-outline-primary">IOS
</span></a><a href=/categories/reverse-engineering/><span class="me-2 badge alert-info text-uppercase px-3 btn-outline-primary">Reverse Engineering</span></a></div><h1 class="display-3 mb-4 px-lg-5">iCDump: A Modern Objective-C Class Dump</h1><div class=post-meta><span class="fw-bold me-3">Romain Thomas
</span><span class="post-date me-3">January 4, 2023</span>
<span class=fw-bold>2 min read</span></div></div></div></div><figure class="position-absolute bottom-0 left-0 w-100 d-none d-md-block mb-n2"><svg class="fill-white" viewBox="0 0 3e3 185.4"><path d="M3e3.0v185.4H0V0c496.4 115.6 996.4 173.4 15e2 173.4S2503.6 115.6 3e3.0z"/></svg></figure></section><section class="section section-lg pt-0 pb-0" id=featured><div class="container mt-n8 mt-lg-n10 z-2 pb-0"><div class="row mt-7 mx-10"><img src=/post/23-01-icdump/featured.webp class="rounded img-fluid" alt=featured.webp></div></div></section><div class="section section-sm bg-white pt-4 pt-lg-4 text-black"><article class=container><div class="row justify-content-center"><div class="col-12 col-lg-9"><p><h2 id=introduction>Introduction</h2><p>iCDump is a tool to access and process Objective-C metadata located in 64-bits Mach-O binaries.
It uses LIEF to load the raw Objective-C data and LLVM to output the reconstructed Objective-C structures.
The <em>LLVM output</em> was inspired by <a href=https://github.com/lifting-bits/rellic>rellic</a> developed by Trail of Bits.</p><p>The project is available on GitHub: <a href=https://github.com/romainthomas/iCDump>romainthomas/iCDump</a>.</p><h2 id=quick-start>Quick Start</h2><p>Python wheels for Linux and OSX are available on PyPI such as one can install iCDump through:</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pip install <span style=color:#666>[</span>--user<span style=color:#666>]</span> icdump
</span></span></code></pre></div><p>Once installed, you can run <a href=https://github.com/romainthomas/iCDump/blob/main/bindings/python/tools/readobjc.py>readobjc.py</a>
to quickly extract Objective-C structures from a Mach-O binary:</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ readobjc.py ./RNCryptor.bin
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:green;font-weight:700>@protocol</span> <span style=color:#00f;font-weight:700>__ARCLiteKeyedSubscripting__</span>
</span></span><span style=display:flex><span>- (NSObject <span style=color:#666>*</span>)<span style=color:#00f>objectForKeyedSubscript:</span>(NSObject <span style=color:#666>*</span>)<span style=color:#19177c>self</span> <span style=color:#666>:</span>(<span style=color:#b00040>SEL</span>)<span style=color:#b00040>id</span> <span style=color:#666>:</span>(NSObject <span style=color:#666>*</span>)arg2;
</span></span><span style=display:flex><span>- (<span style=color:#b00040>void</span>)<span style=color:#00f>setObject:</span>(NSObject <span style=color:#666>*</span>)<span style=color:#19177c>self</span> <span style=color:#00f>forKeyedSubscript:</span>(<span style=color:#b00040>SEL</span>)<span style=color:#19177c>id</span> <span style=color:#666>:</span>(NSObject <span style=color:#666>*</span>)<span style=color:#a0a000>arg2</span> :(NSObject <span style=color:#666>*</span>)arg3;
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>@end</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>@interface</span> <span style=color:#00f;font-weight:700>PodsDummy_RNCryptor_iOS</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>@end</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>@interface</span> <span style=color:#00f;font-weight:700>RNCryptor</span>.RNCryptor.Encryptor{
</span></span><span style=display:flex><span>    NSObject <span style=color:#666>*</span> encryptor;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>@end</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>@interface</span> <span style=color:#00f;font-weight:700>RNCryptor</span>.RNCryptor.Decryptor{
</span></span><span style=display:flex><span>    NSObject <span style=color:#666>*</span> decryptors;
</span></span><span style=display:flex><span>    NSObject <span style=color:#666>*</span> buffer;
</span></span><span style=display:flex><span>    NSObject <span style=color:#666>*</span> decryptor;
</span></span><span style=display:flex><span>    NSObject <span style=color:#666>*</span> password;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>@end</span>
</span></span></code></pre></div><p>Using the Python API, we can output these header-like structures as follows:</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>icdump</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>metadata <span style=color:#666>=</span> icdump<span style=color:#666>.</span>objc<span style=color:#666>.</span>parse(<span style=color:#ba2121>&#34;./RNCryptor.bin&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green>print</span>(metadata<span style=color:#666>.</span>to_decl())
</span></span></code></pre></div><h2 id=limitations>Limitations</h2><p>In its current form, iCDump can only process Objective-C metadata but the Swift structures also aim at being
supported by iCDump. I started a PoC for this part but it&rsquo;s far from being ready to be merged.</p><p>The second limitation is Windows. Theoretically, iCDump and its Python bindings, could be compiled for Windows but to
be honest, for this release I was lazy to setup the CI pipeline with LLVM for Windows. Nevertheless,
Windows users should be able to play with iCDump thanks to WSL.</p><p>The API documentation needs to be written and generated with Sphinx but in the meanwhile, you can directly have
a look at the <a href=https://github.com/romainthomas/iCDump/blob/main/bindings/python/src/ObjC/init.cpp>Python binding</a>
which synthesis the important functions.</p></p></div></div></div></div></main><script src=/vendor/bootstrap/dist/js/bootstrap.min.js></script><script src=/vendor/headroom.js/dist/headroom.min.js></script><script src=/vendor/onscreen/dist/on-screen.umd.min.js></script><script src=/vendor/jarallax/dist/jarallax.min.js></script><script src=/vendor/smooth-scroll/dist/smooth-scroll.polyfills.min.js></script><script src=/js/theme.bundle.js></script><script src=/vendor/@glidejs/glide/dist/glide.min.js></script><script src=/js/anime.min.js></script></body></html>