<!doctype html><html lang=en-us prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=manifest href=manifest.webmanifest><link rel=icon type=image/png href=/img/favicon/favicon_hu2a60c33e6cc729e53465c846fe50d8b2_13867_32x32_fill_box_center_3.png><link rel=apple-touch-icon type=image/png href=/img/favicon/favicon_hu2a60c33e6cc729e53465c846fe50d8b2_13867_192x192_fill_box_center_3.png><meta name=description content="QuarkslaB Dynamic Loader: Generic loader for ELF, PE and Mach-O"><meta name=keywords content="lief,loader"><meta property="og:type" content="article"><meta property="og:description" content="QuarkslaB Dynamic Loader: Generic loader for ELF, PE and Mach-O"><meta property="og:title" content="QBDL | Romain Thomas"><meta property="og:site_name" content="Romain Thomas"><meta property="og:image" content="https://www.romainthomas.fr/project/qbdl/featured.png"><meta property="og:url" content="https://www.romainthomas.fr/project/qbdl/"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2021-06-03T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-25T18:25:50+02:00"><meta property="article:tag" content="lief"><meta property="article:tag" content="loader"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@rh0main"><meta name=twitter:creator content="@rh0main"><meta name=twitter:title content="QBDL | Romain Thomas"><meta name=twitter:description content="QuarkslaB Dynamic Loader: Generic loader for ELF, PE and Mach-O"><meta name=twitter:domain content="https://www.romainthomas.fr/project/qbdl/"><meta property="twitter:image" content="https://www.romainthomas.fr/project/qbdl/featured.png"><title>Romain Thomas</title><link rel=canonical href=https://www.romainthomas.fr/project/qbdl/><link rel=stylesheet href=/css/fa-all.min.css><link rel=stylesheet href=/vendor/@glidejs/glide/dist/css/glide.core.min.css><link rel=stylesheet href=/vendor/@glidejs/glide/dist/css/glide.theme.min.css><link rel=stylesheet href=/css/theme.bundle.css><style>.hide{opacity:0}</style><noscript><style>.hide{opacity:1;!important}</style></noscript><style>.hero_background{position:relative;overflow:hidden}.hero_background:before{pointer-events:none;content:' ';display:block;position:absolute;left:0;top:0;width:100%;height:90%;z-index:1;opacity:.2;background-image:url(/img/bg_home.svg);background-repeat:repeat;background-position:50%;background-size:100%;transform:rotate(180deg)}.project_bg{position:relative;overflow:hidden}.project_bg:before{pointer-events:none;content:' ';display:block;position:absolute;left:0;top:0;width:100%;height:100%;z-index:1;opacity:.1;background-image:url(/img/bg_project.svg);background-repeat:repeat;background-position:50%;background-size:100%;transform:rotate(180deg)}.experience_bg{position:relative;overflow:hidden}.experience_bg:before{pointer-events:none;content:' ';display:block;position:absolute;left:0;top:0;width:100%;height:100%;z-index:1;opacity:.1;background-image:url(/img/bg_experience.svg);background-position:0 0;background-size:100%}.post_bg{position:relative;overflow:hidden}.post_bg:before{pointer-events:none;content:' ';display:block;position:absolute;left:0;top:0;width:100%;height:80%;z-index:1;opacity:.6;background-image:url(/img/bg_post.svg);background-position:0 0;background-size:100%}.contact_bg{position:relative;overflow:hidden}.contact_bg:before{pointer-events:none;content:' ';display:block;position:absolute;left:0;top:0;width:100%;height:80%;z-index:1;opacity:.2;background-image:url(/img/bg_contact.svg);background-position:0 0;background-size:100%}.footnotes p{margin-bottom:0}.highlight{padding-left:20px;border-left:1px solid rgba(0,0,0,.1);border-radius:2px 2px}</style></head><body><header class=header-global><nav id=navbar-main aria-label="Primary navigation" class="navbar navbar-main navbar-expand-lg navbar-theme-primary headroom navbar-dark"><div class="container position-relative"><a class="navbar-brand me-lg-5" href=https://www.romainthomas.fr/><span class="navbar-brand-dark ft-ananda">R. T</span>
<span class="navbar-brand-light ft-ananda">R. T</span></a><div class="navbar-collapse collapse me-auto" id=navbar_global><div class=navbar-collapse-header><div class=row><div class="col-6 collapse-close"><a href=#navbar_global class="fas fa-times" data-bs-toggle=collapse data-bs-target=#navbar_global aria-controls=navbar_global aria-expanded=false title=close aria-label="Toggle navigation"></a></div></div></div><ul class="navbar-nav navbar-nav-hover align-items-lg-center"><li class=nav-item><a href=https://www.romainthomas.fr/#about class="nav-link fw-bold"><span class="fa-regular fa-person-swimming"></span> About</a></li><li class=nav-item><a href=https://www.romainthomas.fr/#posts class="nav-link fw-bold"><span class="fa-regular fa-blog"></span> Posts</a></li><li class=nav-item><a href=https://www.romainthomas.fr/#projects class="nav-link fw-bold"><span class="fa-regular fa-terminal"></span> Projects</a></li><li class=nav-item><a href=https://www.romainthomas.fr/#publications class="nav-link fw-bold"><span class="far fa-book-open-cover"></span> Publications</a></li><li class=nav-item><a href=https://www.romainthomas.fr/#work-experience class="nav-link fw-bold"><span class="fa-regular fa-briefcase"></span> Work Experience</a></li><li class=nav-item><a href=https://www.romainthomas.fr/#misc class="nav-link fw-bold"><span class="fa-regular fa-chart-network"></span> Misc</a></li><li class=nav-item><a href=https://www.romainthomas.fr/#contact class="nav-link fw-bold"><span class="fa-regular fa-binary-lock"></span> Contact</a></li></ul></div><div class="d-flex align-items-center"><button class="navbar-toggler ms-2 collapsed" type=button data-bs-toggle=collapse data-bs-target=#navbar_global aria-controls=navbar_global aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button></div></div></nav></header><main><section class="min-vh-100 d-flex align-items-center section-image overlay-soft-dark bg-primary"><div class=container><div class="row justify-content-center"><div class="col-12 align-items-center justify-content-center"><div class="me-4 mt-6 m-lg-6 bg-white shadow-soft border rounded border-gray-300 p-4 p-lg-5 fmxw-md-100"><div class="col-12 ext-center mb-4"><h2 class=display-3>QBDL</h2><p class=mb-0>June 3, 2021</p></div><div class="col-12 col-md-10"><a href=https://github.com/quarkslab/QBDL target=_blank><button class="btn btn-pill btn-outline-primary mb-2" type=button>
<span class=me-1><span class="fab fa-github"></span></span> Sources</button></a></div><article class="container mt-4"><p>QBDL (<strong>Q</strong>uarksla<strong>B</strong> <strong>D</strong>ynamic <strong>L</strong>oader) is a cross-platform library that enables
to load ELF, PE and Mach-O binaries with an abstraction on the targeted system.
It abstracts the memory model on which the binary is loaded
and provides an enhanced API to the user to process symbols resolution.
In a nutshell, it enables to load binaries on foreign systems without reinventing the wheel.</p><p>Here is an <a href=https://github.com/quarkslab/QBDL/blob/83a64211dae71e870495bc795dd065278f93993f/bindings/python/examples/triton_macho_x64.py>example</a> to load a Mach-O in <a href=https://github.com/JonathanSalwan/Triton>Triton</a> with QBDL:</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>TritonVM</span>(pyqbdl<span style=color:#666>.</span>TargetMemory):
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>def</span> __init__(self, ctx: TritonContext):
</span></span><span style=display:flex><span>        <span style=color:green>super</span>()<span style=color:#666>.</span>__init__()
</span></span><span style=display:flex><span>        self<span style=color:#666>.</span>ctx <span style=color:#666>=</span> ctx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>def</span> <span style=color:#00f>mmap</span>(self, ptr, size):
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>return</span> ptr
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>def</span> <span style=color:#00f>mprotect</span>(self, ptr, size, access):
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>return</span> <span style=color:green;font-weight:700>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>def</span> <span style=color:#00f>write</span>(self, ptr, data):
</span></span><span style=display:flex><span>        self<span style=color:#666>.</span>ctx<span style=color:#666>.</span>setConcreteMemoryAreaValue(ptr, <span style=color:green>bytes</span>(data))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>def</span> <span style=color:#00f>read</span>(self, ptr, size):
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>return</span> self<span style=color:#666>.</span>ctx<span style=color:#666>.</span>getConcreteMemoryAreaValue(ptr, size)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>TritonSystem</span>(pyqbdl<span style=color:#666>.</span>TargetSystem):
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>def</span> __init__(self, arch, ctx):
</span></span><span style=display:flex><span>        <span style=color:green>super</span>()<span style=color:#666>.</span>__init__(TritonVM(ctx))
</span></span><span style=display:flex><span>        self<span style=color:#666>.</span>arch <span style=color:#666>=</span> arch
</span></span><span style=display:flex><span>        self<span style=color:#666>.</span>ctx <span style=color:#666>=</span> ctx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>def</span> <span style=color:#00f>symlink</span>(self, loader, sym):
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>for</span> name, impl, addr <span style=color:#a2f;font-weight:700>in</span> externalFunctions:
</span></span><span style=display:flex><span>            <span style=color:green;font-weight:700>if</span> sym<span style=color:#666>.</span>name <span style=color:#666>==</span> name:
</span></span><span style=display:flex><span>                <span style=color:green;font-weight:700>return</span> addr
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>return</span> <span style=color:#666>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>def</span> <span style=color:#00f>supports</span>(self, bin_):
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>return</span> pyqbdl<span style=color:#666>.</span>Arch<span style=color:#666>.</span>from_bin(bin_) <span style=color:#666>==</span> self<span style=color:#666>.</span>arch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>def</span> <span style=color:#00f>base_address_hint</span>(self, bin_ba, vsize):
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>return</span> bin_ba
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>x86_64_arch <span style=color:#666>=</span> pyqbdl<span style=color:#666>.</span>Arch(lief<span style=color:#666>.</span>ARCHITECTURES<span style=color:#666>.</span>X86, lief<span style=color:#666>.</span>ENDIANNESS<span style=color:#666>.</span>LITTLE, <span style=color:green;font-weight:700>True</span>)
</span></span><span style=display:flex><span>loader <span style=color:#666>=</span> pyqbdl<span style=color:#666>.</span>loaders<span style=color:#666>.</span>MachO<span style=color:#666>.</span>from_file(args<span style=color:#666>.</span>filename, x86_64_arch,
</span></span><span style=display:flex><span>                                        TritonSystem(x86_64_arch, ctx), pyqbdl<span style=color:#666>.</span>Loader<span style=color:#666>.</span>BIND<span style=color:#666>.</span>NOW)
</span></span></code></pre></div></article></div></div></div></div></section></main><script src=/vendor/bootstrap/dist/js/bootstrap.min.js></script>
<script src=/vendor/headroom.js/dist/headroom.min.js></script>
<script src=/vendor/onscreen/dist/on-screen.umd.min.js></script>
<script src=/vendor/jarallax/dist/jarallax.min.js></script>
<script src=/vendor/smooth-scroll/dist/smooth-scroll.polyfills.min.js></script>
<script src=/js/theme.bundle.js></script>
<script src=/vendor/@glidejs/glide/dist/glide.min.js></script>
<script src=/js/anime.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css integrity=sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js integrity=sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p crossorigin=anonymous></script>
<script>function katex_load(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\begin{equation}",right:"\\end{equation}",display:!0},{left:"\\begin{align}",right:"\\end{align}",display:!0},{left:"\\begin{alignat}",right:"\\end{alignat}",display:!0},{left:"\\begin{gather}",right:"\\end{gather}",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})}</script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=katex_load()></script></body></html>